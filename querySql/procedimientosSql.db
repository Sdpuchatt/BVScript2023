--Store procedure
--sd_ (en Master)
-- locales (del usuario)
-- Temporales (#)
-- globales(##)
use pruebasCheck;

CREATE OR ALTER PROC PRO_EXISTENCIA
--CREATE PROCEDURE
AS
	SELECT * FROM ARTICULOS WHERE CANTIDAD <=20;
--EJECUCION
EXEC PRO_EXISTENCIA
--PRACTICA
CREATE OR ALTER PROCEDURE PRO_ACTUALIZA_INVENTARIO
AS
	BEGIN
		IF EXISTS(SELECT * FROM ARTICULOS WHERE CANTIDAD = 0)
		UPDATE ARTICULOS SET CANTIDAD = 10
		WHERE CANTIDAD = 0
	END
EXEC PRO_ACTUALIZA_INVENTARIO

UPDATE ARTICULOS SET CANTIDAD = 0 WHERE CODIGO IN(1,2,3)
SELECT * FROM ARTICULOS
--PRACTICA
SELECT * FROM EMPLEADOS
CREATE OR ALTER PROC P_BONIFICACION2
AS
	BEGIN
		IF (EXISTS(SELECT * FROM EMPLEADOS WHERE cant_hijos>2))
			BEGIN
				UPDATE EMPLEADOS SET SUELDO = SUELDO*1.20 WHERE cant_hijos>2;
				PRINT 'SE HA APLICADO LA BONIFICACION'
			END
		ELSE 
			BEGIN
				PRINT 'NO HAY EMPLEADOS CON MAS DE 2 HIJOS'
			END
	END
EXEC P_BONIFICACION2

--Clase ALTER
--CLASE 3
CREATE OR ALTER PROCEDURE PRO_BUSCA_EMPLE
	@NOMBRE VARCHAR(30) = 'CARLOS'
AS
	SELECT * FROM EMPLEADOS WHERE NOMBRE = @NOMBRE
EXEC PRO_BUSCA_EMPLE
--
CREATE OR ALTER PROC PRO_BUSCA_EMPLE_2
	@NOMBRE VARCHAR(30) = 'Laura',
	@SUELDO INT = 50400,
	@HIJOS INT = 3
AS
  SELECT * FROM EMPLEADOS WHERE NOMBRE = @NOMBRE 
								AND SUELDO = @SUELDO
								AND cant_hijos = @HIJOS
EXEC PRO_BUSCA_EMPLE_2
SELECT * FROM EMPLEADOS;

--CLASE 4 PARAMETROS DE SALIDA
CREATE OR ALTER PROC PRO_PROMEDIO
	@VALOR1 NUMERIC (6,2),
	@VALOR2 NUMERIC (6,2),
	@RESULTADO NUMERIC (6,2) OUTPUT
AS
  SELECT @RESULTADO = (@VALOR1 + @VALOR2)/2
--ESTO ES PARA EJECUTAR EL PROCEDIMIENTO
DECLARE
	@PROMEDIO NUMERIC (6,2)
	EXEC PRO_PROMEDIO 20,40,@PROMEDIO OUTPUT
	SELECT @PROMEDIO AS PROMEDIO


--OTRO EJEMPLO SALIDA DE DATOS
CREATE OR ALTER PROC PRO_EMPLE_SAL_PROMEDIO
	@PUESTO VARCHAR(30) = '%',
	@SUMA NUMERIC OUTPUT,
	@PROMEDIO NUMERIC OUTPUT
AS
	SELECT * FROM EMPLEADOS WHERE PUESTO LIKE @PUESTO
	SELECT @SUMA = SUM(SUELDO) FROM EMPLEADOS WHERE PUESTO LIKE @PUESTO
	SELECT @PROMEDIO = AVG(SUELDO) FROM EMPLEADOS WHERE PUESTO LIKE @PUESTO
--ESTO ES PARA EJECUTAR EL PROCEDIMIENTO
DECLARE
	@SUMATORIA NUMERIC, @PROM NUMERIC
	EXEC PRO_EMPLE_SAL_PROMEDIO 'CONTADOR',
	@SUMATORIA OUTPUT, @PROM OUTPUT
	SELECT @SUMATORIA AS TOTAL, @PROM AS PROMEDIO


SELECT * FROM EMPLEADOS