IF CURRENTRECORD("USR_LIBSUE_V_NROBLQ") = "04"  OR CURRENTRECORD("USR_LIBSUE_V_NROBLQ") = "05"   THEN
A="'"
'SSQL = "SELECT SUM(CASE SUBSTRING(SJRMVI_TIPCPT,1,1) WHEN 'E' THEN  SJRMVI_CALCUL "
'SSQL = SSQL + "ELSE 0 END) FROM SJRMVI WHERE "
'SSQL = SSQL + "SJRMVI_NROLEG = "&CURRENTRECORD("NUMEROLEGAJO")
'SSQL = SSQL + " AND SJRMVI_PERIOD = '"&PARAMETERS("PERIODO").VALUES(1).FROMVALUESQL
'SSQL = SSQL + " ' AND SJRMVI_FECALT <= '"&ACTUALREG("FECALT")&A
'SSQL = SSQL + " AND SJRMVI_CLAEMP = '"&ACTUALREG("CLAEMP")&A

SSQL = " "
SSQL = SSQL + " SELECT ISNULL(SUM(SJRMVI_CALCUL),0) FROM SJRMVI "
SSQL = SSQL + " INNER JOIN SJRMVH ON SJRMVI_CODFOR = SJRMVH_CODFOR "
SSQL = SSQL + " AND SJRMVI_NROFOR = SJRMVH_NROFOR "
SSQL = SSQL + " AND SJRMVI_TIPLIQ = SJRMVH_TIPLIQ "
SSQL = SSQL + " AND SJRMVI_PERIOD = SJRMVH_PERIOD "
SSQL = SSQL + " AND SJRMVI_NROLEG = SJRMVH_NROLEG "
SSQL = SSQL + " WHERE SUBSTRING(SJRMVI_TIPCPT,1,1) = 'E' "
SSQL = SSQL + " AND SJRMVI_PERIOD = "&PARAMETERS("PERIODO").VALUES(1).FROMVALUESQL
SSQL = SSQL + " AND SJRMVI_NROLEG = "&ACTUALREG("NUMEROLEGAJO")
SSQL = SSQL + " AND SJRMVI_FECALT <= '"&ACTUALREG("FECALT")&A
SSQL = SSQL + " AND SJRMVH_CIERRE = 'S' "

RESULT = queryExec(CSTR(SSQL))

END IF