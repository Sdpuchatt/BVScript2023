IF CURRENTRECORD("USR_LIBSUE_V_NROBLQ") = "04" THEN
    PERIODO = PARAMETERS("PERIODO").VALUES(1).FROMVALUESQL
    MES = MID(CSTR(PERIODO),5,2)  
    ANIO = MID(CSTR(PERIODO),1,4)
    CUIL = CURRENTRECORD("DOCUMENTO")
        IF CURRENTRECORD("CODOBS") = "SIN OBS" THEN
            CODOBS = "000000"
        ELSE
            CODOBS = CURRENTRECORD("CODOBS") 
        END IF
    CODACT = CURRENTRECORD("CODACT")
    COEF=PARAMETERS("PARAM_COEF").VALUES(1).FROMVALUETEXT

        IF CODACT = "" THEN 
        	CODACT = "00"
        END IF 

HIJOS = CURRENTRECORD("HIJOS")
ESPOSA = CURRENTRECORD("CONYU")

SSQL = "SELECT SJMLGI_SELECC FROM SJMLGI WHERE "
SSQL = SSQL + "SJMLGI_CODVAR = 'CONCCT' AND "
SSQL = SSQL + "SJMLGI_NROLEG = "&CURRENTRECORD("NUMEROLEGAJO")
CONCONV = QUERYEXEC(CSTR(SSQL))

IF CONCONV = "S" THEN
	CONCONV = 1
ELSE
	CONCONV = 0
END IF

ADI = CURRENTRECORD("REPARTO")

CODZON = CURRENTRECORD("CODZON")
IF CODZON ="" THEN 
	CODZON = "00"
END IF 

CODSIT = CURRENTRECORD("CODSIT")
IF CODSIT ="" THEN 
	CODSIT = "00"
END IF 

CODCON = CURRENTRECORD("CODCON")
IF CODCON ="" THEN 
	CODCON = "00"
END IF 

MODCON = CURRENTRECORD("MODCON")
IF MODCON="" THEN 
	MODCON= "00"
END IF 

'NOMBRE =  MID(CURRENTRECORD("NOMBRE"),1,30)
'CODOBS2 = MID(CSTR(CURRENTRECORD("CODOBS")),1,6)

SEGVID = ACTUALREG("SEGURO_VIDA")

CORRED = PARAMETERS("MARCCRED").VALUES(1).FROMVALUESQL
IF CORRED = "S" THEN
    CORRED = 1
ELSE
    CORRED = 0
END IF

CODEMP = PARAMETERS("CODEMPASOCTRABJ").VALUES(1).FROMVALUETEXT


REM ME FIJO CANTIDAD DE ADHERENTES OBRA SOCIAL
NROLEG = "'" & ACTUALREG("NUMEROLEGAJO") & "'" 

SSQL = " "
SSQL = SSQL + " SELECT SJMLGI_IMPORT FROM SJMLGI WHERE SJMLGI_NROLEG = " &NROLEG
SSQL = SSQL + " AND SJMLGI_CODVAR = 'ADHER' "
CANT_ADE = QUERYEXEC(CSTR(SSQL))

REM INICIALIZO IMPONIBLES
NOREMOBR=CURRENTRECORD("OBRNOREM")

IMPO1 =  CURRENTRECORD("IMPO1")
IF IMPO1 = 0 THEN 
	IMPO1 = 0.00
END IF
IMPO2 =  CURRENTRECORD("IMPO2")
IF IMPO2 = 0 THEN 
	IMPO2 = 0.00
END IF
IMPO3 =  CURRENTRECORD("IMPO3")
IF IMPO3 = 0 THEN 
	IMPO3 = 0.00
END IF
IMPO4 =  CURRENTRECORD("IMPO4")+NOREMOBR
IF IMPO4 = 0 THEN 
	IMPO4 = 0.00
END IF
IMPO5 =  CURRENTRECORD("IMPO5")
IF IMPO5 = 0 THEN 
	IMPO5 = 0.00
END IF
IMPO8 =  CURRENTRECORD("IMPO8")
IF IMPO8 = 0 THEN 
	IMPO8 = 0.00
END IF
IMPO9 = CURRENTRECORD("IMPO9")
IF IMPO9 = 0 THEN 
	IMPO9 = 0.00
END IF 

REMUNE = CURRENTRECORD("REMTOT")
IF REMUNE = 0 THEN 
	REMUNE = 0.01
END IF 

NOREMU =  CURRENTRECORD("REMUNE2")

'CADOS =  CURRENTRECORD("CAOS")
'PROV =  CURRENTRECORD("PROV")
'RG =  CURRENTRECORD("REG")
'CON =  CURRENTRECORD("CONV")

APOR_OS =  CURRENTRECORD("ADIO")

MES = MID(CSTR(PERIODO),5,2)


'DC_BASICO = CURRENTRECORD("BASICO_DC") 
'DC_PREMIO = CURRENTRECORD("PREMIO_DC") 
'DC_HORAS = ROUND(CURRENTRECORD("HORAS_DC"),2)
'DC_SAC = CURRENTRECORD("SAC_DC")  
'DC_VACAC = CURRENTRECORD("VACAC_DC")

'INASISTENCIA=CURRENTRECORD("INASISTENCIA")



REM CHEQUEO EL TOTAL DE DATOS COMPLEMENTARIO NO SEA MAYOR AL IMPONIBLE 1
'DC_SUELDO = ROUND( (IMPO2  - (DC_BASICO + DC_PREMIO + DC_HORAS + DC_SAC + DC_VACAC )) ,2)


REM DIAS DEL MES
DDM = 30
IF CINT(MES) = 2 AND DDM = 30 THEN 
	 FECHABISIESTO =(ANIO/4)-INT(ANIO/4)
	 IF (FECHABISIESTO = 0) THEN
		 DDM=29
	 ELSE
		 DDM=28
	 END IF
END IF

IF (CINT(MES) = 1 OR   CINT(MES) = 3 OR CINT(MES) = 5  OR CINT(MES) = 7 OR CINT(MES) = 8  OR CINT(MES) = 10  OR  CINT(MES) = 12)  AND DDM = 30 THEN 
 DDM =  31
END IF 


REM DEFINO CANTIDAD DE DIAS TRABAJADOS EN EL PERIODO.
 IF  CURRENTRECORD("DIAS") = 100 THEN
	 D = 30
 ELSE
	 D = CURRENTRECORD("DIAS")
 END IF

'IF CINT(MES) = 2 AND D = 30 THEN 

'		FECHABISIESTO=(ANIO/4)-INT(ANIO/4)
		
'		IF (FECHABISIESTO= 0) THEN
'			D=29
'		ELSE
'			D=28
'		END IF

'END IF  

'IF (CINT(MES) = 1 OR   CINT(MES) = 3 OR CINT(MES) = 5  OR CINT(MES) = 7 OR CINT(MES) = 8  OR CINT(MES) = 10  OR  CINT(MES) = 12)  AND D = 30 THEN 
'	D =  31
'END IF 
		
REM ACA COMIENZA EL CALCULO PARA LAS SITUACIONES DE REVISTA DURANTE EL PERIODO

IF CINT(MES) = 2  THEN 
	DIAS_MAY =  28
END IF 

IF CINT(MES) = 1 OR   CINT(MES) = 3 OR CINT(MES) = 5  OR CINT(MES) = 7 OR CINT(MES) = 8  OR CINT(MES) = 10  OR  CINT(MES) = 12 THEN 
	DIAS_MAY =  31
END IF 

IF CINT(MES) = 4 OR   CINT(MES) = 6  OR CINT(MES) = 9  OR CINT(MES) = 11THEN 
	DIAS_MAY =  30
END IF 

REM COMIENZO CON EL CALCULO DE SITUACIONES DE REVISTA
'OBTENGO LA CANTIDAD DE DIAS DEL PERIODO
DIAS_MAY = DAY(DATESERIAL(ANIO, MES + 1, 0))


REM TRAIGO LOS VALORES DE SITUACIONES DE REVISTA Y DIAS DE INICIO SEGUN TABLA DE ESTADOS "USR_ESTADES"
PRIMER = ACTUALREG("PRIMERO")
IF PRIMER <> 0 THEN 
	 DIA1_I = ACTUALREG("DIA1_I") 	 
	 DIA1_F = ACTUALREG("DIA1_F") 	 
ELSE
	 DIA1_I =  0 	 
	 DIA1_F = 0
END IF 

SEGUNDO = ACTUALREG("SEGUNDO") 

IF SEGUNDO <> 0 AND SEGUNDO <> PRIMER THEN 
	 DIA2_I = ACTUALREG("DIA2_I") 	 
	 DIA2_F = ACTUALREG("DIA2_F") 	 
ELSE
	 DIA2_I =  0 	 
	 DIA2_F = 0
END IF 

REM FIN DE ASIGNACION DE VALORES DE SITUACION DE REVISTA


DIA1= 1
SIT1= 1
DIA2= 1
SIT2= 1
DIA3= 1
SIT3= 1

REM COMIENZO A VER LAS SITUACIONES DE REVISTA
REM GENERAR LAS SITUACIONES DE REVISTA DE ACUERDO A LA CRONOLOGIA DE LOS HECHOS.
REM SI LA SITUACION DE REVISTA 

IF PRIMER <> 0 THEN 
	DOS_USADO = FALSE
	TRES_USADO = FALSE
	SIT_AUX_PRIM = 0
	DIA_AUX_PRIM = 0
	SIT_AUX_SEG = 0
	DIA_AUX_SEG = 0
	
	'SI COMIENZA EL PRIMER DÍA DEL MES
	IF CINT(DIA1_I) = 1 THEN 
		SIT1 = PRIMER
		DIA1 = DIA1_I
	ELSE
		'EMPEZÓ ACTIVO 
		SIT1 = 1
		DIA1 = 1
		'LA PRIMERA SITUACIÓN REGISTRADA VA A LA SIT2
		SIT2 = PRIMER
		DIA2 = DIA1_I
		
		DOS_USADO = TRUE
	END IF

	'SI TERMINA ANTES DE FIN DE MES, LO TENGO EN CUENTA PORQUE POSIBLEMENTE LO DEBA INFORMAR
	IF CINT(DIA1_F) < CINT(DIAS_MAY) THEN
		SIT_AUX_PRIM = 1
		DIA_AUX_PRIM = DIA1_F + 1
	END IF

	'NO HAY SEGUNDA SITUACIÓN, POR LO QUE VEO CUÁNDO TERMINÓ LA PRIMERA PARA VER SI CORRESPONDE INFORMAR QUE VOLVIÓ A LA ACTIVIDAD
	IF SEGUNDO = 0 THEN
		IF NOT DOS_USADO THEN
		REM	SIT2 = SIT_AUX_PRIM 
		REM	DIA2 = DIA_AUX_PRIM
			SIT2 = "  "
			DIA2 = 0
			DOS_USADO = TRUE
		ELSE
		REM	SIT3 = SIT_AUX_PRIM 
		REM	DIA3 = DIA_AUX_PRIM
			SIT3 = "  "
			DIA3 = 0
			TRES_USADO = TRUE
		END IF
	ELSE
		'SI TERMINA ANTES DE FIN DE MES, LO TENGO EN CUENTA PORQUE POSIBLEMENTE LO DEBA INFORMAR
		IF CINT(DIA2_F) < CINT(DIAS_MAY) THEN
			SIT_AUX_SEG = 1
			DIA_AUX_SEG = DIA2_F + 1
		END IF		

		IF NOT DOS_USADO THEN
			'SI NO HAY NADA QUE INFORMAR SOBRE EL FIN DEL SEGUNDO (PORQUE TERMINA EL ULTIMO DIA DEL MES) MANDO EL FIN DEL PRIMERO Y DEJO A SEGUNDO PARA LA ÚLTIMA POSICION
			IF SIT_AUX_SEG = 0 THEN
				SIT2 = SIT_AUX_PRIM 
				DIA2 = DIA_AUX_PRIM
				DOS_USADO = TRUE
				
				SIT3 = SEGUNDO 
				DIA3 = DIA2_I
				TRES_USADO = TRUE
			ELSE
				SIT2 = SEGUNDO 
				DIA2 = DIA2_I
				DOS_USADO = TRUE
				
				SIT3 = SIT_AUX_SEG
				DIA3 = DIA_AUX_SEG
				TRES_USADO = TRUE			
			END IF

		ELSE
			'ESTÁ USADO EL DOS, POR LO QUE EMPEZÓ ACTIVO EN UNO, SE GUARDÓ LA PRIMERA SITUACIÓN DE REVISTA EN DOS Y EN TRES HAY QUE VER SI LA SEGUNDO ABARCA HASTA FIN DE MES O NO. SI TERMINA EL MES VA SEGUNDO, SINO SE LO INFORMA COMO ACTIVO A LA FINALIZACION DE SEGUNDO
			IF SIT_AUX_SEG = 0 THEN
				SIT3 = SEGUNDO 
				DIA3 = DIA2_I
			ELSE
				SIT3 = SIT_AUX_SEG
				DIA3 = DIA_AUX_SEG
			END IF
			TRES_USADO = TRUE
		END IF
	END IF
ELSE	
	'EMPEZÓ ACTIVO Y NO SE REGISTRAN SITUACIONES DE REVISTA
	SSQL = "SELECT SJMLGA_CODVAL FROM SJMLGA "
    SSQL = SSQL + "WHERE SJMLGA_CODATR = 'CODSIT' "
    SSQL = SSQL + "AND SJMLGA_NROLEG = "&CURRENTRECORD("NUMEROLEGAJO")
 
    SIT1 = QUERYEXEC(CSTR(SSQL))
    
	DIA1 = 1
    SIT2 = 0
	DIA2 = 0
	SIT3 = 0
	DIA3 = 0

END IF

REM FINALIZA EL CALCULO PARA LAS SITUACIONES DE REVISTA DURANTE EL PERIODO


IF SIT3 = 0 THEN 
	IF SIT2 = 0 THEN 
		  CODSIT = SIT1
	ELSE 
		  CODSIT = SIT2
	END IF
ELSE 
	CODSIT = SIT3
END IF 



IF CODSIT =  2  THEN 
	CODSIT = 1
END IF 

IF CODSIT=18 THEN

	SINI="01"

ELSE

	SINI = "00"

END IF

'IF PARAMETERS("TIPLIQ").VALUES(1).FROMVALUESQL = "'MATER'" THEN
'    SIT1 = 5
'    SIT2 = 5
'    DIA2 = 0
'    SIT3 = 5
'    DIA3 = 0
'    CODSIT = 5
'    REMUNE = 0
'END IF


IF D = 0 THEN 
    HS = 1
ELSE 
    HS = 0
END IF 


MATER = CURRENTRECORD("MATER")

TIPOLIQ = PARAMETERS("TIPLIQ").VALUES(1).FROMVALUESQL

'CALCULO IMPONIBLE 10 / MONTO A DETRAER / MONTO A DETRAER EN CASO DE SER AGUINALDO



MONDETRAER = (D/30)*COEF

IF (((CINT(MES) = 6) or (CINT(MES) = 12)) AND (TIPOLIQ = "'SAC'" OR TIPOLIQ = "'SACD'")) THEN  
    DIASPSAC=ACTUALREG("DIAS_SAC")
    MONDETRAERSAC=((COEF/2)/180)*DIASPSAC

    IF MONDETRAERSAC<0 THEN
        MONDETRAERSAC=COEF/2
    END IF

    MONDETRAER = MONDETRAER + (MONDETRAERSAC)
END IF

HORTRA = QUERYEXEC(CSTR("SELECT SJMLGI_IMPORT FROM SJMLGI WHERE SJMLGI_CODVAR = 'HORTRA' AND SJMLGI_NROLEG = "&NROLEG))

    IF HORTRA = 100 THEN 'Vale
        MONDETRAER = MONDETRAER/2
    ELSE
        IF HORTRA = 30 THEN 'Claudia
            MONDETRAER = 0
        ELSE
            MONDETRAER = MONDETRAER 'Resto
        END IF
    END IF

IMPO10 = (IMPO2 - MONDETRAER)


AUXREMUNE = CURRENTRECORD("IMPO1") 

'SSQL = "SELECT SJCCOV_IMPORT FROM SJCCOV WHERE "
'SSQL = SSQL + "SJCCOV_CODCPT = '60100' AND "
'SSQL = SSQL + "SJCCOV_CODVAR= 'CON002' "
'MINIMOIMP = queryExec(CSTR(SSQL))
MINIMOIMP = 0

'MsgBox("AUXREMUNE: "&AUXREMUNE &" IMPO10: "&IMPO10)

'IF (AUXREMUNE - IMPO10 > 0)  AND (AUXREMUNE - IMPO10 > MINIMOIMP) THEN
'    IMPO10 = (IMPO2 - MONDETRAER)
'ELSE
'    IF (AUXREMUNE - IMPO10) > 0  AND (AUXREMUNE - IMPO10 < MINIMOIMP) AND (AUXREMUNE - MINIMOIMP > 0) THEN
'        MONDETRAER = AUXREMUNE - MINIMOIMP
'        IMPO10 = (IMPO2 - MONDETRAER)
'    ELSE
'        MONDETRAER = 0
'        IMPO10 = 0
'    END IF
'END IF


IF MONDETRAER = 0 THEN
    IMPO10 = 0  
END IF

IF IMPO10 = 0.01 THEN
	IMPO10 = 0
END IF


'EXCLUSIVO DIRECTORES------------------

NROLEGAJO = ACTUALREG("NUMEROLEGAJO")
TIPOLEGAJO = QUERYEXEC(CSTR("SELECT SJMLGA_CODVAL FROM SJMLGA WHERE SJMLGA_CODATR = 'TIPLEG' AND SJMLGA_NROLEG = "&NROLEGAJO))


IF TIPOLEGAJO = "D" THEN
	SSQL = "SELECT SJCCOV_IMPORT FROM SJCCOV WHERE SJCCOV_CODCPT = 55000 AND SJCCOV_CODVAR = 'CONST1'"
	TOPE = QUERYEXEC(CSTR(SSQL))
	NO_REMUNERATIVO = ACTUALREG("REMUNE2")

	IF (NO_REMUNERATIVO <= 0) THEN
		IMPO145 = 0
	ELSE
		IF (NO_REMUNERATIVO > TOPE) THEN
			IMPO145 = TOPE
		ELSE
			IMPO145 = NO_REMUNERATIVO
		END IF 
	END IF

    

    IF CURRENTRECORD("CODOBS") = "SIN OBS" THEN


	    IMPO1 = IMPO145
        IMPO2 = NO_REMUNERATIVO
        IMPO3 = NO_REMUNERATIVO
        IMPO4 = IMPO145
        IMPO5 = IMPO145
        IMPO8 = NO_REMUNERATIVO
        IMPO10 = 0.00

        MODCON = 99
        SINI = 00

    ELSE

        IMPO1 = IMPO145
        IMPO2 = NO_REMUNERATIVO
        IMPO3 = NO_REMUNERATIVO
        IMPO4 = IMPO145
        IMPO5 = IMPO145
        IMPO8 = NO_REMUNERATIVO
        IMPO10 = 0.00

    END IF

    IMPO9 = NO_REMUNERATIVO
    MONDETRAER = 0

END IF

'MSGBOX("IMPO1: "&IMPO1&" IMPO2: "&IMPO2&" IMPO3: "&IMPO3&" IMPO4: "&IMPO4&" IMPO5: "&IMPO5&" IMPO6: "&IMPO6&" IMPO7: "&IMPO7&" IMPO8: "&IMPO8&" IMPO9: "&IMPO9&" IMPO10: "&IMPO10)

'Base de cálculo diferencial de aportes/contribuciones de Obra Social (para trabajadores de tiempo parcial) diferenciado si está en OSECAC
IF (HORTRA <= 100 AND HORTRA <> 0) THEN
    REMUNERATIVO = ACTUALREG("REMUNE")
    ACUERDOS_NOREMU = ACTUALREG("ACUE_NR")

    IF (CODOBS = 126205) THEN
        APOR_DIF = IMPO4 - (REMUNERATIVO+ACUERDOS_NOREMU)
        CONT_DIF = IMPO8 - (REMUNERATIVO+ACUERDOS_NOREMU)
    ELSE
        APOR_DIF = IMPO4 - (REMUNERATIVO)
        CONT_DIF = IMPO8 - (REMUNERATIVO)
    END IF
ELSE
    APOR_DIF = 0
    CONT_DIF = 0
END IF


'MSGBOX("LEGAJO: "&NROLEG&vbNewLine&vbNewLine&"REM 2: "&IMPO2&vbNewLine&"REM 3: "&IMPO3&vbNewLine&"REM 4: "&IMPO4&vbNewLine&"REM 8: "&IMPO8&vbNewLine&"REM 9: "&IMPO9&vbNewLine&"Monto a Detraer: "&MONDETRAER&vbNewLine&"REM 10: "&IMPO10&vbNewLine&"Adicional Obra Social: "&ADI)

'-------------------------------------

    X_RESULT = CURRENTRECORD("USR_LIBSUE_V_NROBLQ")&""&(CUIL)&""&C_NUMERO(ESPOSA,1,0)&""&MID(CSTR(C_NUMERO(HIJOS,2,0)),1,2)&""&C_NUMERO(CONCONV,1,0)&""&SEGVID&""&C_NUMERO(CORRED,1,0)&""
    X_RESULT = X_RESULT & C_NUMERO(CODEMP,1,0)&""&C_NUMERO(0,1,0)&""&C_NUMERO(CODSIT,2,0)&""&C_NUMERO(CODCON,2,0)&""&C_NUMERO(CODACT,3,0)&""&C_NUMERO(MODCON,3,0)&""&C_NUMERO(SINI,2,0)&""
    X_RESULT = X_RESULT & C_NUMERO(CODZON,2,0)&""&C_NUMERO(SIT1,2,0)&""&C_NUMERO(DIA1,2,0)&""&C_NUMERO(SIT2,2,0)&""&C_NUMERO(DIA2,2,0)&""&C_NUMERO(SIT3,2,0)&""&C_NUMERO(DIA3,2,0)&""
    X_RESULT = X_RESULT & C_NUMERO(D,2,0)&""&C_NUMERO(HS,3,0)&""&C_NUMERO(ADI,5,2)&""&C_NUMERO(0,5,2)&""&(CODOBS)&""&C_NUMERO(CANT_ADE,2,0)&""&C_NUMERO(APOR_OS,15,2)&""
    X_RESULT = X_RESULT & C_NUMERO(0,15,2)&""&C_NUMERO(APOR_DIF,15,2)&""&C_NUMERO(CONT_DIF,15,2)&""&C_NUMERO(0,15,2)&""&C_NUMERO(MATER,15,2)&""&C_NUMERO(REMUNE,15,2)&""&C_NUMERO(IMPO1,15,2)&""
    X_RESULT = X_RESULT & C_NUMERO(IMPO2,15,2)&""&C_NUMERO(IMPO3,15,2)&""&C_NUMERO(IMPO4,15,2)&""&C_NUMERO(IMPO5,15,2)&""&C_NUMERO(0,15,2)&""&C_NUMERO(0,15,2)&""&C_NUMERO(IMPO8,15,2)&""
    X_RESULT = X_RESULT & C_NUMERO(IMPO9,15,2)&""&C_NUMERO(0,15,2)&""&C_NUMERO(0,15,2)&""&C_NUMERO(IMPO10,15,2)&""&C_NUMERO(MONDETRAER,15,2)


    RESULT = X_RESULT



    FUNCTION C_NUMERO(CAMPO,LARGO, DECIMALES)
    CAMPO= REPLACE(CAMPO, "*", "")
    AUXNUMERO=FORMATNUMBER(CAMPO,DECIMALES,,,0)
    AUXNUMERO= REPLACE(AUXNUMERO, ".", "")
    IF INSTR(AUXNUMERO,"-") <> 0 THEN
        AUXNUMERO= REPLACE(AUXNUMERO, "-", "")
        C_NUMERO= "-" &STRING((LARGO-1) - LEN(TRIM(AUXNUMERO)),"0") & TRIM(AUXNUMERO)
    ELSE
        C_NUMERO= STRING(LARGO - LEN(TRIM(AUXNUMERO)),"0") & TRIM(AUXNUMERO)
    END IF
    END FUNCTION

    FUNCTION C_STRING(CAMPO,LARGO)
    C_STRING= TRIM(CAMPO) & STRING(LARGO - LEN(TRIM(CAMPO))," ")
    END FUNCTION


    FUNCTION C_DERECHA(CAMPO,LARGO)
    C_DERECHA=STRING(LARGO - LEN(TRIM(CAMPO))," ") &TRIM(CAMPO)
    END FUNCTION
END IF